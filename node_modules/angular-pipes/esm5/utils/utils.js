import * as tslib_1 from "tslib";
export function isUndefined(value) {
    return typeof value === 'undefined';
}
export function isNull(value) {
    return value === null;
}
export function isNumber(value) {
    return typeof value === 'number';
}
export function isNumberFinite(value) {
    return isNumber(value) && isFinite(value);
}
// Not strict positive
export function isPositive(value) {
    return value >= 0;
}
export function isInteger(value) {
    // No rest, is an integer
    return (value % 1) === 0;
}
export function isNil(value) {
    return value === null || typeof (value) === 'undefined';
}
export function isString(value) {
    return typeof value === 'string';
}
export function isObject(value) {
    return value !== null && typeof value === 'object';
}
export function isArray(value) {
    return Array.isArray(value);
}
export function isFunction(value) {
    return typeof value === 'function';
}
export function toDecimal(value, decimal) {
    return Math.round(value * Math.pow(10, decimal)) / Math.pow(10, decimal);
}
export function upperFirst(value) {
    return value.slice(0, 1).toUpperCase() + value.slice(1);
}
export function createRound(method) {
    // <any>Math to suppress error
    var func = Math[method];
    return function (value, precision) {
        if (precision === void 0) { precision = 0; }
        if (typeof value === 'string') {
            throw new TypeError('Rounding method needs a number');
        }
        if (typeof precision !== 'number' || isNaN(precision)) {
            precision = 0;
        }
        if (precision) {
            var pair = (value + "e").split('e');
            var val = func(pair[0] + "e" + (+pair[1] + precision));
            pair = (val + "e").split('e');
            return +(pair[0] + 'e' + (+pair[1] - precision));
        }
        return func(value);
    };
}
export function leftPad(str, len, ch) {
    if (len === void 0) { len = 0; }
    if (ch === void 0) { ch = ' '; }
    str = String(str);
    ch = toString(ch);
    var i = -1;
    var length = len - str.length;
    while (++i < length && (str.length + ch.length) <= len) {
        str = ch + str;
    }
    return str;
}
export function rightPad(str, len, ch) {
    if (len === void 0) { len = 0; }
    if (ch === void 0) { ch = ' '; }
    str = String(str);
    ch = toString(ch);
    var i = -1;
    var length = len - str.length;
    while (++i < length && (str.length + ch.length) <= len) {
        str += ch;
    }
    return str;
}
export function toString(value) {
    return "" + value;
}
export function pad(str, len, ch) {
    if (len === void 0) { len = 0; }
    if (ch === void 0) { ch = ' '; }
    str = String(str);
    ch = toString(ch);
    var i = -1;
    var length = len - str.length;
    var left = true;
    while (++i < length) {
        var l = (str.length + ch.length <= len) ? (str.length + ch.length) : (str.length + 1);
        if (left) {
            str = leftPad(str, l, ch);
        }
        else {
            str = rightPad(str, l, ch);
        }
        left = !left;
    }
    return str;
}
export function flatten(input, index) {
    if (index === void 0) { index = 0; }
    if (index >= input.length) {
        return input;
    }
    if (isArray(input[index])) {
        return flatten(input.slice(0, index).concat(input[index], input.slice(index + 1)), index);
    }
    return flatten(input, index + 1);
}
export function getProperty(value, key) {
    var e_1, _a;
    if (isNil(value) || !isObject(value)) {
        return undefined;
    }
    var keys = key.split('.');
    var result = value[keys.shift()];
    try {
        for (var keys_1 = tslib_1.__values(keys), keys_1_1 = keys_1.next(); !keys_1_1.done; keys_1_1 = keys_1.next()) {
            var key_1 = keys_1_1.value;
            if (isNil(result) || !isObject(result)) {
                return undefined;
            }
            result = result[key_1];
        }
    }
    catch (e_1_1) { e_1 = { error: e_1_1 }; }
    finally {
        try {
            if (keys_1_1 && !keys_1_1.done && (_a = keys_1.return)) _a.call(keys_1);
        }
        finally { if (e_1) throw e_1.error; }
    }
    return result;
}
export function sum(input, initial) {
    if (initial === void 0) { initial = 0; }
    return input.reduce(function (previous, current) { return previous + current; }, initial);
}
// http://stackoverflow.com/questions/6274339/how-can-i-shuffle-an-array-in-javascript
export function shuffle(input) {
    if (!isArray(input)) {
        return input;
    }
    var copy = tslib_1.__spread(input);
    for (var i = copy.length; i; --i) {
        var j = Math.floor(Math.random() * i);
        var x = copy[i - 1];
        copy[i - 1] = copy[j];
        copy[j] = x;
    }
    return copy;
}
export function deepIndexOf(collection, value) {
    var index = -1;
    var length = collection.length;
    while (++index < length) {
        if (deepEqual(value, collection[index])) {
            return index;
        }
    }
    return -1;
}
export function deepEqual(a, b) {
    if (a === b) {
        return true;
    }
    if (!(typeof a === 'object' && typeof b === 'object')) {
        return a === b;
    }
    var keysA = Object.keys(a);
    var keysB = Object.keys(b);
    if (keysA.length !== keysB.length) {
        return false;
    }
    // Test for A's keys different from B.
    var hasOwn = Object.prototype.hasOwnProperty;
    for (var i = 0; i < keysA.length; i++) {
        var key = keysA[i];
        if (!hasOwn.call(b, keysA[i]) || !deepEqual(a[key], b[key])) {
            return false;
        }
    }
    return true;
}
export function isDeepObject(object) {
    return object.__isDeepObject__;
}
export function wrapDeep(object) {
    return new DeepWrapper(object);
}
export function unwrapDeep(object) {
    if (isDeepObject(object)) {
        return object.data;
    }
    return object;
}
var DeepWrapper = /** @class */ (function () {
    function DeepWrapper(data) {
        this.data = data;
        this.__isDeepObject__ = true;
    }
    return DeepWrapper;
}());
export { DeepWrapper };
export function count(input) {
    if (!isArray(input) && !isObject(input) && !isString(input)) {
        return input;
    }
    if (isObject(input)) {
        return Object.keys(input).map(function (value) { return input[value]; }).length;
    }
    return input.length;
}
export function empty(input) {
    if (!isArray(input)) {
        return input;
    }
    return input.length === 0;
}
export function every(input, predicate) {
    if (!isArray(input) || !predicate) {
        return input;
    }
    var result = true;
    var i = -1;
    while (++i < input.length && result) {
        result = predicate(input[i], i, input);
    }
    return result;
}
export function takeUntil(input, predicate) {
    var i = -1;
    var result = [];
    while (++i < input.length && !predicate(input[i], i, input)) {
        result[i] = input[i];
    }
    return result;
}
export function takeWhile(input, predicate) {
    return takeUntil(input, function (item, index, collection) { return !predicate(item, index, collection); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmd1bGFyLXBpcGVzLyIsInNvdXJjZXMiOlsidXRpbHMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBLE1BQU0sVUFBVSxXQUFXLENBQUUsS0FBVTtJQUVyQyxPQUFPLE9BQU8sS0FBSyxLQUFLLFdBQVcsQ0FBQztBQUN0QyxDQUFDO0FBRUQsTUFBTSxVQUFVLE1BQU0sQ0FBRSxLQUFVO0lBRWhDLE9BQU8sS0FBSyxLQUFLLElBQUksQ0FBQztBQUN4QixDQUFDO0FBRUQsTUFBTSxVQUFVLFFBQVEsQ0FBRSxLQUFVO0lBRWxDLE9BQU8sT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFFLEtBQVU7SUFFeEMsT0FBTyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzVDLENBQUM7QUFFRCxzQkFBc0I7QUFDdEIsTUFBTSxVQUFVLFVBQVUsQ0FBRSxLQUFhO0lBRXZDLE9BQU8sS0FBSyxJQUFJLENBQUMsQ0FBQztBQUNwQixDQUFDO0FBR0QsTUFBTSxVQUFVLFNBQVMsQ0FBRSxLQUFhO0lBRXRDLHlCQUF5QjtJQUN6QixPQUFPLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMzQixDQUFDO0FBRUQsTUFBTSxVQUFVLEtBQUssQ0FBRSxLQUFVO0lBQy9CLE9BQU8sS0FBSyxLQUFLLElBQUksSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssV0FBVyxDQUFDO0FBQzFELENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFFLEtBQVU7SUFFbEMsT0FBTyxPQUFPLEtBQUssS0FBSyxRQUFRLENBQUM7QUFDbkMsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUUsS0FBVTtJQUVsQyxPQUFPLEtBQUssS0FBSyxJQUFJLElBQUksT0FBTyxLQUFLLEtBQUssUUFB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QUFDO0FBRUQsTUFBTSxVQUFVLFNBQVMsQ0FBRSxLQUFZLEVBQUUsU0FBOEI7SUFDckUsT0FBTyxTQUFTLENBQUMsS0FBSyxFQUFFLFVBQUMsSUFBUyxFQUFFLEtBQWEsRUFBRSxVQUFpQixJQUFLLE9BQUEsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxVQUFVLENBQUMsRUFBbkMsQ0FBbUMsQ0FBQyxDQUFDO0FBQ2hILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgdHlwZSBDb2xsZWN0aW9uUHJlZGljYXRlID0gKGl0ZW0/OiBhbnksIGluZGV4PzogbnVtYmVyLCBjb2xsZWN0aW9uPzogYW55W10pID0+IGJvb2xlYW47XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNVbmRlZmluZWQgKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyB1bmRlZmluZWQge1xyXG4gIFxyXG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsICh2YWx1ZTogYW55KTogdmFsdWUgaXMgbnVsbCB7XHJcbiAgXHJcbiAgcmV0dXJuIHZhbHVlID09PSBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNOdW1iZXIgKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyBudW1iZXIge1xyXG4gIFxyXG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNOdW1iZXJGaW5pdGUgKHZhbHVlOiBhbnkpOiB2YWx1ZSBpcyBudW1iZXIge1xyXG4gIFxyXG4gIHJldHVybiBpc051bWJlcih2YWx1ZSkgJiYgaXNGaW5pdGUodmFsdWUpO1xyXG59XHJcblxyXG4vLyBOb3Qgc3RyaWN0IHBvc2l0aXZlXHJcbmV4cG9ydCBmdW5jdGlvbiBpc1Bvc2l0aXZlICh2YWx1ZTogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgXHJcbiAgcmV0dXJuIHZhbHVlID49IDA7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNJbnRlZ2VyICh2YWx1ZTogbnVtYmVyKTogYm9vbGVhbiB7XHJcbiAgXHJcbiAgLy8gTm8gcmVzdCwgaXMgYW4gaW50ZWdlclxyXG4gIHJldHVybiAodmFsdWUgJSAxKSA9PT0gMDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTmlsICh2YWx1ZTogYW55KTogdmFsdWUgaXMgKG51bGx8dW5kZWZpbmVkKSB7XHJcbiAgcmV0dXJuIHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiAodmFsdWUpID09PSAndW5kZWZpbmVkJztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzU3RyaW5nICh2YWx1ZTogYW55KTogdmFsdWUgaXMgc3RyaW5nIHtcclxuICBcclxuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0ICh2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgXHJcbiAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0FycmF5ICh2YWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgXHJcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNGdW5jdGlvbiAodmFsdWU6IGFueSk6IGJvb2xlYW4ge1xyXG4gIFxyXG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbic7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b0RlY2ltYWwgKHZhbHVlOiBudW1iZXIsIGRlY2ltYWw6IG51bWJlcik6IG51bWJlciB7XHJcbiAgXHJcbiAgcmV0dXJuIE1hdGgucm91bmQodmFsdWUgKiBNYXRoLnBvdygxMCwgZGVjaW1hbCkpIC8gTWF0aC5wb3coMTAsIGRlY2ltYWwpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBwZXJGaXJzdCAodmFsdWU6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgXHJcbiAgcmV0dXJuIHZhbHVlLnNsaWNlKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyB2YWx1ZS5zbGljZSgxKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJvdW5kIChtZXRob2Q6IHN0cmluZyk6IEZ1bmN0aW9uIHtcclxuICBcclxuICAvLyA8YW55Pk1hdGggdG8gc3VwcHJlc3MgZXJyb3JcclxuICBjb25zdCBmdW5jOiBhbnkgPSAoPGFueT5NYXRoKVttZXRob2RdO1xyXG4gIHJldHVybiBmdW5jdGlvbiAodmFsdWU6IG51bWJlciwgcHJlY2lzaW9uOiBudW1iZXIgPSAwKSB7XHJcbiAgICBcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1JvdW5kaW5nIG1ldGhvZCBuZWVkcyBhIG51bWJlcicpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAodHlwZW9mIHByZWNpc2lvbiAhPT0gJ251bWJlcicgfHwgaXNOYU4ocHJlY2lzaW9uKSkge1xyXG4gICAgICBwcmVjaXNpb24gPSAwO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAocHJlY2lzaW9uKSB7XHJcbiAgICAgIFxyXG4gICAgICBsZXQgcGFpciA9IGAke3ZhbHVlfWVgLnNwbGl0KCdlJyk7XHJcbiAgICAgIGNvbnN0IHZhbCA9IGZ1bmMoIGAke3BhaXJbMF19ZWAgKyAoK3BhaXJbMV0gKyBwcmVjaXNpb24pKTtcclxuICAgICAgXHJcbiAgICAgIHBhaXIgPSBgJHt2YWx9ZWAuc3BsaXQoJ2UnKTtcclxuICAgICAgcmV0dXJuICsocGFpclswXSArICdlJyArICgrcGFpclsxXSAtIHByZWNpc2lvbikpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZnVuYyh2YWx1ZSk7XHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxlZnRQYWQgKHN0cjogc3RyaW5nLCBsZW46IG51bWJlciA9IDAsIGNoOiBhbnkgPSAnICcpIHtcclxuICBcclxuICBzdHIgPSBTdHJpbmcoc3RyKTtcclxuICBjaCA9IHRvU3RyaW5nKGNoKTtcclxuICBsZXQgaSA9IC0xO1xyXG4gIGNvbnN0IGxlbmd0aCA9IGxlbiAtIHN0ci5sZW5ndGg7XHJcbiAgXHJcbiAgd2hpbGUgKCsraSA8IGxlbmd0aCAmJiAoc3RyLmxlbmd0aCArIGNoLmxlbmd0aCkgPD0gbGVuKSB7XHJcbiAgICBzdHIgPSBjaCArIHN0cjtcclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHN0cjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJpZ2h0UGFkIChzdHI6IHN0cmluZywgbGVuOiBudW1iZXIgPSAwLCBjaDogYW55ID0gJyAnKSB7XHJcbiAgXHJcbiAgc3RyID0gU3RyaW5nKHN0cik7XHJcbiAgY2ggPSB0b1N0cmluZyhjaCk7XHJcbiAgXHJcbiAgbGV0IGkgPSAtMTtcclxuICBjb25zdCBsZW5ndGggPSBsZW4gLSBzdHIubGVuZ3RoO1xyXG4gIFxyXG4gIHdoaWxlICgrK2kgPCBsZW5ndGggJiYgKHN0ci5sZW5ndGggKyBjaC5sZW5ndGgpIDw9IGxlbikge1xyXG4gICAgc3RyICs9IGNoO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gc3RyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9TdHJpbmcgKHZhbHVlOiBudW1iZXJ8c3RyaW5nKSB7XHJcbiAgXHJcbiAgcmV0dXJuIGAke3ZhbHVlfWA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwYWQgKHN0cjogc3RyaW5nLCBsZW46IG51bWJlciA9IDAsIGNoOiBhbnkgPSAnICcpOiBzdHJpbmd7XHJcbiAgXHJcbiAgc3RyID0gU3RyaW5nKHN0cik7XHJcbiAgY2ggPSB0b1N0cmluZyhjaCk7XHJcbiAgbGV0IGkgPSAtMTtcclxuICBjb25zdCBsZW5ndGggPSBsZW4gLSBzdHIubGVuZ3RoO1xyXG4gIFxyXG4gIFxyXG4gIGxldCBsZWZ0ID0gdHJ1ZTtcclxuICB3aGlsZSAoKytpIDwgbGVuZ3RoKSB7XHJcbiAgICBcclxuICAgIGNvbnN0IGwgPSAoc3RyLmxlbmd0aCArIGNoLmxlbmd0aCA8PSBsZW4pID8gKHN0ci5sZW5ndGggKyBjaC5sZW5ndGgpIDogKHN0ci5sZW5ndGggKyAxKTtcclxuICAgIFxyXG4gICAgaWYgKGxlZnQpIHtcclxuICAgICAgc3RyID0gbGVmdFBhZChzdHIsIGwsIGNoKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICBzdHIgPSByaWdodFBhZChzdHIsIGwsIGNoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgbGVmdCA9ICFsZWZ0O1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gc3RyO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZmxhdHRlbiAoaW5wdXQ6IGFueVtdLCBpbmRleDogbnVtYmVyID0gMCk6IGFueVtdIHtcclxuICBcclxuICBpZiAoaW5kZXggPj0gaW5wdXQubGVuZ3RoKSB7XHJcbiAgICByZXR1cm4gaW5wdXQ7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChpc0FycmF5KGlucHV0W2luZGV4XSkpIHtcclxuICAgIHJldHVybiBmbGF0dGVuKFxyXG4gICAgaW5wdXQuc2xpY2UoMCwgaW5kZXgpLmNvbmNhdChpbnB1dFtpbmRleF0sIGlucHV0LnNsaWNlKGluZGV4ICsgMSkpLFxyXG4gICAgaW5kZXhcclxuICAgICk7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBmbGF0dGVuKGlucHV0LCBpbmRleCArIDEpO1xyXG4gIFxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFByb3BlcnR5ICh2YWx1ZTogeyBba2V5OiBzdHJpbmddOiBhbnl9LCBrZXk6IHN0cmluZyk6IGFueSB7XHJcbiAgXHJcbiAgaWYgKGlzTmlsKHZhbHVlKSB8fCAhaXNPYmplY3QodmFsdWUpKSB7XHJcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IGtleS5zcGxpdCgnLicpO1xyXG4gIGxldCByZXN1bHQ6IGFueSA9IHZhbHVlW2tleXMuc2hpZnQoKSFdO1xyXG4gIFxyXG4gIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcclxuICAgIGlmIChpc05pbChyZXN1bHQpIHx8ICFpc09iamVjdChyZXN1bHQpKSB7XHJcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJlc3VsdCA9IHJlc3VsdFtrZXldO1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc3VtIChpbnB1dDogQXJyYXk8bnVtYmVyPiwgaW5pdGlhbCA9IDApOiBudW1iZXIge1xyXG4gIFxyXG4gIHJldHVybiBpbnB1dC5yZWR1Y2UoKHByZXZpb3VzOiBudW1iZXIsIGN1cnJlbnQ6IG51bWJlcikgPT4gcHJldmlvdXMgKyBjdXJyZW50LCBpbml0aWFsKTtcclxufVxyXG5cclxuLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy82Mjc0MzM5L2hvdy1jYW4taS1zaHVmZmxlLWFuLWFycmF5LWluLWphdmFzY3JpcHRcclxuZXhwb3J0IGZ1bmN0aW9uIHNodWZmbGUgKGlucHV0OiBhbnkpOiBhbnkge1xyXG4gIFxyXG4gIGlmICghaXNBcnJheShpbnB1dCkpIHtcclxuICAgIHJldHVybiBpbnB1dDtcclxuICB9XHJcbiAgXHJcbiAgY29uc3QgY29weSA9IFsuLi5pbnB1dF07XHJcbiAgXHJcbiAgZm9yIChsZXQgaSA9IGNvcHkubGVuZ3RoOyBpOyAtLWkpIHtcclxuICAgIGNvbnN0IGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBpKTtcclxuICAgIGNvbnN0IHggPSBjb3B5W2kgLSAxXTtcclxuICAgIGNvcHlbaSAtIDFdID0gY29weVtqXTtcclxuICAgIGNvcHlbal0gPSB4O1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gY29weTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlZXBJbmRleE9mIChjb2xsZWN0aW9uOiBhbnlbXSwgdmFsdWU6IGFueSkge1xyXG4gIFxyXG4gIGxldCBpbmRleCA9IC0xO1xyXG4gIGNvbnN0IGxlbmd0aCA9IGNvbGxlY3Rpb24ubGVuZ3RoO1xyXG4gIFxyXG4gIHdoaWxlICgrK2luZGV4IDwgbGVuZ3RoKSB7XHJcbiAgICBpZiAoZGVlcEVxdWFsKHZhbHVlLCBjb2xsZWN0aW9uW2luZGV4XSkpIHtcclxuICAgICAgcmV0dXJuIGluZGV4O1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICByZXR1cm4gLTE7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVlcEVxdWFsIChhOiBhbnksIGI6IGFueSkge1xyXG4gIFxyXG4gIGlmIChhID09PSBiKSB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbiAgXHJcbiAgaWYgKCEodHlwZW9mIGEgPT09ICdvYmplY3QnICYmIHR5cGVvZiBiID09PSAnb2JqZWN0JykpIHtcclxuICAgIHJldHVybiBhID09PSBiO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBrZXlzQSA9IE9iamVjdC5rZXlzKGEpO1xyXG4gIGNvbnN0IGtleXNCID0gT2JqZWN0LmtleXMoYik7XHJcbiAgXHJcbiAgaWYgKGtleXNBLmxlbmd0aCAhPT0ga2V5c0IubGVuZ3RoKSB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIFxyXG4gIC8vIFRlc3QgZm9yIEEncyBrZXlzIGRpZmZlcmVudCBmcm9tIEIuXHJcbiAgdmFyIGhhc093biA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzQS5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3Qga2V5ID0ga2V5c0FbaV07XHJcbiAgICBpZiAoIWhhc093bi5jYWxsKGIsIGtleXNBW2ldKSB8fCAhZGVlcEVxdWFsKGFba2V5XSwgYltrZXldKSkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiB0cnVlO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNEZWVwT2JqZWN0IChvYmplY3Q6IGFueSkge1xyXG4gIFxyXG4gIHJldHVybiBvYmplY3QuX19pc0RlZXBPYmplY3RfXztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHdyYXBEZWVwIChvYmplY3Q6IGFueSkge1xyXG4gIFxyXG4gIHJldHVybiBuZXcgRGVlcFdyYXBwZXIob2JqZWN0KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVud3JhcERlZXAgKG9iamVjdDogYW55KSB7XHJcbiAgXHJcbiAgaWYgKGlzRGVlcE9iamVjdChvYmplY3QpKSB7XHJcbiAgICByZXR1cm4gb2JqZWN0LmRhdGE7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBvYmplY3Q7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEZWVwV3JhcHBlciB7XHJcbiAgXHJcbiAgcHVibGljIF9faXNEZWVwT2JqZWN0X186IGJvb2xlYW4gPSB0cnVlO1xyXG4gIFxyXG4gIGNvbnN0cnVjdG9yIChwdWJsaWMgZGF0YTogYW55KSB7fVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY291bnQgKGlucHV0OiBhbnkpOiBhbnkge1xyXG4gIFxyXG4gIGlmICghaXNBcnJheShpbnB1dCkgJiYgIWlzT2JqZWN0KGlucHV0KSAmJiAhaXNTdHJpbmcoaW5wdXQpKSB7XHJcbiAgICByZXR1cm4gaW5wdXQ7XHJcbiAgfVxyXG4gIFxyXG4gIGlmIChpc09iamVjdChpbnB1dCkpIHtcclxuICAgIHJldHVybiBPYmplY3Qua2V5cyhpbnB1dCkubWFwKCh2YWx1ZSkgPT4gaW5wdXRbdmFsdWVdKS5sZW5ndGg7XHJcbiAgfVxyXG4gIFxyXG4gIHJldHVybiBpbnB1dC5sZW5ndGg7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlbXB0eSAoaW5wdXQ6IGFueSk6IGFueSB7XHJcbiAgXHJcbiAgaWYgKCFpc0FycmF5KGlucHV0KSkge1xyXG4gICAgcmV0dXJuIGlucHV0O1xyXG4gIH1cclxuICBcclxuICByZXR1cm4gaW5wdXQubGVuZ3RoID09PSAwO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXZlcnkgKGlucHV0OiBhbnksIHByZWRpY2F0ZTogQ29sbGVjdGlvblByZWRpY2F0ZSkge1xyXG4gIFxyXG4gIGlmICghaXNBcnJheShpbnB1dCkgfHwgIXByZWRpY2F0ZSkge1xyXG4gICAgcmV0dXJuIGlucHV0O1xyXG4gIH1cclxuICBcclxuICBsZXQgcmVzdWx0ID0gdHJ1ZTtcclxuICBsZXQgaSA9IC0xO1xyXG4gIFxyXG4gIHdoaWxlICgrK2kgPCBpbnB1dC5sZW5ndGggJiYgcmVzdWx0KSB7XHJcbiAgICByZXN1bHQgPSBwcmVkaWNhdGUoaW5wdXRbaV0sIGksIGlucHV0KTtcclxuICB9XHJcbiAgXHJcbiAgXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHRha2VVbnRpbCAoaW5wdXQ6IGFueVtdLCBwcmVkaWNhdGU6IENvbGxlY3Rpb25QcmVkaWNhdGUpIHtcclxuXHJcbiAgbGV0IGkgPSAtMTtcclxuICBjb25zdCByZXN1bHQ6IGFueSA9IFtdO1xyXG4gIHdoaWxlICgrK2kgPCBpbnB1dC5sZW5ndGggJiYgIXByZWRpY2F0ZShpbnB1dFtpXSwgaSwgaW5wdXQpKSB7XHJcbiAgICByZXN1bHRbaV0gPSBpbnB1dFtpXTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0YWtlV2hpbGUgKGlucHV0OiBhbnlbXSwgcHJlZGljYXRlOiBDb2xsZWN0aW9uUHJlZGljYXRlKSB7XHJcbiAgcmV0dXJuIHRha2VVbnRpbChpbnB1dCwgKGl0ZW06IGFueSwgaW5kZXg6IG51bWJlciwgY29sbGVjdGlvbjogYW55W10pID0+ICFwcmVkaWNhdGUoaXRlbSwgaW5kZXgsIGNvbGxlY3Rpb24pKTtcclxufVxyXG4iXX0=